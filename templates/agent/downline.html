<!-- templates/agent/downline.html -->
<!DOCTYPE html>
<html>
<head>
    <title>My Downline Network</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .stats { display: flex; gap: 15px; margin: 20px 0; flex-wrap: wrap; }
        .stat-card { background: white; padding: 15px; border-radius: 8px; flex: 1; min-width: 150px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .stat-value { font-size: 1.8em; font-weight: bold; }
        .downline-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .downline-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .agent-info { display: flex; align-items: center; margin-bottom: 15px; }
        .agent-avatar { font-size: 40px; margin-right: 15px; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: #e9ecef; }
        .agent-details { flex: 1; }
        .commission-rate { padding: 3px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; display: inline-block; margin-top: 5px; }
        .direct-rate { background: #e3f2fd; color: #1565c0; }
        .indirect-rate { background: #fff3cd; color: #856404; }
        .btn { padding: 8px 16px; border-radius: 5px; text-decoration: none; display: inline-block; }
        .btn-back { background: #6c757d; color: white; }
        .empty-state { text-align: center; padding: 50px 20px; background: white; border-radius: 10px; color: #666; }
        .earnings-badge { background: #d4edda; color: #155724; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: 5px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin: 30px 0 15px 0; padding-bottom: 10px; border-bottom: 2px solid #eee; }
        .relationship-badge { padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .direct-badge { background: #e3f2fd; color: #1565c0; }
        .indirect-badge { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üë• My Downline Network</h1>
        <div>
            <a href="/agent/dashboard" class="btn btn-back">‚Üê Back to Dashboard</a>
        </div>
    </div>
    
    <!-- Enhanced Stats -->
    <div class="stats">
        <div class="stat-card">
            <div style="font-size: 14px; color: #666;">Total Downline</div>
            <div class="stat-value" style="color: #007bff;">{{ stats.total_downline }}</div>
            <small>{{ stats.direct_downline_count }} direct + {{ stats.indirect_downline_count }} indirect</small>
        </div>
        <div class="stat-card">
            <div style="font-size: 14px; color: #666;">Direct Earnings</div>
            <div class="stat-value" style="color: #28a745;">RM{{ "%.2f"|format(stats.total_direct_earnings|float) }}</div>
            <small>5% from direct downlines</small>
        </div>
        <div class="stat-card">
            <div style="font-size: 14px; color: #666;">Indirect Earnings</div>
            <div class="stat-value" style="color: #6f42c1;">RM{{ "%.2f"|format(stats.total_indirect_earnings|float) }}</div>
            <small>2.5% from indirect downlines</small>
        </div>
        <div class="stat-card">
            <div style="font-size: 14px; color: #666;">Your Total Earnings</div>
            <div class="stat-value" style="color: #fd7e14;">RM{{ "%.2f"|format(stats.total_your_earnings|float) }}</div>
            <small>From entire network</small>
        </div>
    </div>
    
    <!-- DIRECT DOWNLINES SECTION -->
    {% if direct_downline_agents %}
    <div class="section-header">
        <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
            <h2 style="margin: 0; font-size: 1.5em;">
                üìã Direct Downlines ({{ direct_downline_agents|length }})
            </h2>
        
            <div style="display: flex; align-items: center; gap: 15px; background: #f8f9fa; padding: 8px 15px; border-radius: 10px; border-left: 4px solid #007bff;">
                <!-- Commission -->
                <div style="text-align: center;">
                    <div style="font-size: 11px; color: #6c757d; font-weight: 500;">COMMISSION</div>
                    <div style="color: #1565c0; font-weight: bold; font-size: 16px;">5%</div>
                </div>
            
                <div style="width: 1px; height: 25px; background: #dee2e6;"></div>
            
                <!-- Total Earnings -->
                <div style="text-align: center;">
                    <div style="font-size: 11px; color: #6c757d; font-weight: 500;">TOTAL</div>
                    <div style="color: #28a745; font-weight: bold; font-size: 18px;">
                    RM{{ "%.2f"|format(stats.total_direct_earnings|float) }}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="downline-grid">
        {% for agent in direct_downline_agents %}
        <div class="downline-card">
            <div class="agent-info">
                <div class="agent-avatar">üë§</div>
                <div class="agent-details">
                    <strong style="font-size: 18px;">{{ agent.name }}</strong>
                    <div style="color: #666; font-size: 14px;">{{ agent.email }}</div>
                    <div style="margin-top: 8px;">
                        <span class="commission-rate direct-rate">
                            {{ agent.commission_percentage }} commission to you
                        </span>
                        {% if agent.earnings_from_agent > 0 %}
                        <span class="earnings-badge">
                            RM{{ "%.2f"|format(agent.earnings_from_agent|float) }} earned
                        </span>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span style="color: #666;">Agent ID:</span>
                    <span>#{{ agent.id }}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: #666;">Joined:</span>
                    <span>{{ agent.join_date }}</span>
                </div>
                {% if agent.commission_count > 0 %}
                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                    <span style="color: #666;">Commissions:</span>
                    <span style="color: #28a745; font-weight: bold;">
                        {{ agent.commission_count }} sales
                    </span>
                </div>
                {% endif %}
            </div>
            
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <a href="/agent/downline-performance/{{ agent.id }}" class="btn" style="background: #17a2b8; color: white; padding: 6px 12px; font-size: 12px;">View Performance</a>
                <a href="mailto:{{ agent.email }}" class="btn" style="background: #28a745; color: white; padding: 6px 12px; font-size: 12px;">Send Email</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="padding: 20px; background: white; border-radius: 10px; margin: 20px 0; text-align: center;">
        <h3 style="color: #666;">No Direct Downlines Yet</h3>
        <p style="color: #888;">You don't have any direct agents under your supervision yet.</p>
    </div>
    {% endif %}
    
    <!-- INDIRECT DOWNLINES SECTION -->
    {% if indirect_downline_agents %}
    <div class="section-header">
        <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
            <h2 style="margin: 0; font-size: 1.5em;">
                üìã Indirect Downlines ({{ indirect_downline_agents|length }})
            </h2>
        
            <div style="display: flex; align-items: center; gap: 15px; background: #f8f9fa; padding: 8px 15px; border-radius: 10px; border-left: 4px solid #6f42c1;">
                <!-- Commission -->
                <div style="text-align: center;">
                    <div style="font-size: 11px; color: #6c757d; font-weight: 500;">COMMISSION</div>
                    <div style="color: #6f42c1; font-weight: bold; font-size: 16px;">2.5%</div>
                </div>
            
                <div style="width: 1px; height: 25px; background: #dee2e6;"></div>
            
                <!-- Total Earnings -->
                <div style="text-align: center;">
                    <div style="font-size: 11px; color: #6c757d; font-weight: 500;">TOTAL</div>
                    <div style="color: #6f42c1; font-weight: bold; font-size: 18px;">
                        RM{{ "%.2f"|format(stats.total_indirect_earnings|float) }}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="downline-grid">
        {% for agent in indirect_downline_agents %}
        <div class="downline-card">
            <div class="agent-info">
                <div class="agent-avatar">üë•</div>
                <div class="agent-details">
                    <strong style="font-size: 18px;">{{ agent.name }}</strong>
                    <div style="color: #666; font-size: 14px;">{{ agent.email }}</div>
                    <div style="margin-top: 8px;">
                        <span class="commission-rate indirect-rate">
                            {{ agent.commission_percentage }} commission to you
                        </span>
                        {% if agent.earnings_from_agent > 0 %}
                        <span class="earnings-badge">
                            RM{{ "%.2f"|format(agent.earnings_from_agent|float) }} earned
                        </span>
                        {% endif %}
                    </div>
                    <div style="margin-top: 5px; font-size: 12px; color: #666;">
                        Via: {{ agent.direct_upline_name }}
                    </div>
                </div>
            </div>
            
            <div style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span style="color: #666;">Agent ID:</span>
                    <span>#{{ agent.id }}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: #666;">Joined:</span>
                    <span>{{ agent.join_date }}</span>
                </div>
                {% if agent.commission_count > 0 %}
                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                    <span style="color: #666;">Indirect Commissions:</span>
                    <span style="color: #6f42c1; font-weight: bold;">
                        {{ agent.commission_count }} sales
                    </span>
                </div>
                {% endif %}
            </div>
            
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <a href="/agent/downline-performance/{{ agent.id }}" class="btn" style="background: #6c757d; color: white; padding: 6px 12px; font-size: 12px;">View Profile</a>
                <a href="mailto:{{ agent.email }}" class="btn" style="background: #28a745; color: white; padding: 6px 12px; font-size: 12px;">Send Email</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="padding: 20px; background: white; border-radius: 10px; margin: 20px 0; text-align: center;">
        <h3 style="color: #666;">No Indirect Downlines Yet</h3>
        <p style="color: #888;">Indirect downlines appear when your direct downlines recruit their own agents.</p>
    </div>
    {% endif %}
    
    <!-- Network Info Section -->
    <div style="margin-top: 30px; padding: 20px; background: #e8f4ff; border-radius: 10px;">
        <h3>üí∞ Multi-Level Commission System</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
            <div>
                <strong>üìà Your Earnings Structure:</strong>
                <ul style="margin: 10px 0 0 20px;">
                    <li><strong>Direct Downlines:</strong> 5% of their commission</li>
                    <li><strong>Indirect Downlines:</strong> 2.5% of their commission</li>
                    <li><strong>Network Depth:</strong> Current system supports 2 levels</li>
                    <li><strong>Payout:</strong> Weekly or Monthly commissions</li>
                </ul>
            </div>
            <div>
                <strong>üë• Building Your Network:</strong>
                <ul style="margin: 10px 0 0 20px;">
                    <li>Recruit agents to become your <strong>direct downlines</strong></li>
                    <li>When they recruit agents, they become your <strong>indirect downlines</strong></li>
                    <li>Each level adds to your passive income stream</li>
                    <li>Network grows exponentially as agents recruit others</li>
                </ul>
            </div>
        </div>
        <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #007bff;">
            <strong>üí° Current Network Status:</strong>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                <div>
                    ‚úÖ <strong>Direct Downlines:</strong> {{ stats.direct_downline_count }} agents
                    <div style="margin-left: 20px;">‚Ä¢ 5% commission rate</div>
                    <div style="margin-left: 20px;">‚Ä¢ RM{{ "%.2f"|format(stats.total_direct_earnings|float) }} earned</div>
                </div>
                <div>
                    ‚úÖ <strong>Indirect Downlines:</strong> {{ stats.indirect_downline_count }} agents
                    <div style="margin-left: 20px;">‚Ä¢ 2.5% commission rate</div>
                    <div style="margin-left: 20px;">‚Ä¢ RM{{ "%.2f"|format(stats.total_indirect_earnings|float) }} earned</div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>